if: branch = master
language: php
os:
- linux
dist: xenial
jobs:
  include:
  - name: PHPCS - PHP 7.2
    php: '7.2'
    env: WP_VERSION=latest WP_MULTISITE=0
    install:
    - composer install
    script:
    - vendor/bin/phpcs -s --extensions=php,js ./
  - name: WP oldest - PHP 7.2
    php: '7.2'
    env: WP_VERSION=5.1 WP_MULTISITE=0
  - name: WP latest - PHP 5.6
    php: '5.6'
    env: WP_VERSION=latest WP_MULTISITE=0
  - name: WP latest - PHP 8.0
    php: '8.0'
    env: WP_VERSION=latest WP_MULTISITE=0
  - name: WP latest multisite - PHP 7.2
    php: '7.2'
    env: WP_VERSION=latest WP_MULTISITE=1
  - name: WP nightly - PHP 8.0
    php: '8.0'
    env: WP_VERSION=nightly WP_MULTISITE=0
  allow_failures:
  - php: '8.0'
    env: WP_VERSION=nightly WP_MULTISITE=0
services:
- mysql
cache:
  directories:
  - "${HOME}/.composer/cache"
before_install:
- phpenv config-rm xdebug.ini
- export PATH="$(composer config --absolute --global bin-dir):${PATH}"
install:
- |
  if [[ "${TRAVIS_PHP_VERSION:0:1}" == "8" ]]; then
    composer require --no-interaction --update-with-dependencies --ignore-platform-reqs --dev "wpsyntex/wp-phpunit:dev-branch-7.5"
  elif [[ "${TRAVIS_PHP_VERSION:0:3}" == "5.6" ]]; then
    composer require --no-interaction --update-with-dependencies --dev "wpsyntex/wp-phpunit:dev-branch-5.7"
  else
    composer install --no-interaction
  fi
- bash vendor/wpsyntex/wp-phpunit/bin/install-wp-tests.sh wordpress_test root "" localhost
  "${WP_VERSION}"
- bash tests/bin/install-plugins.sh
script:
- vendor/bin/phpunit --verbose
notifications:
  email:
    on_success: never
    on_failure: change
  slack:
    rooms:
      secure: drFTYGOw/gNcfG6JfWeM6lNA2FOhWOs6CAsTTKWB4qfgOvKBbkIc7xYi8OxFK+sm4fhwOFEoXKZZc1igy5SqedMtTbSQVNC32HHbUZH3LEhbXirLBdGTNY1bwasKAyc7KxDLIVYzkHauibJrrENCBwteGxQNHTfCjyND0a+OXzng7Zumf995DFMfOKdkVY5lIbD/MwMci3nDiwA/80GjIPWX7U5VQ3SYfRAgGJGIA4W0MZ+D6kH9ye6YEL4y7Fo9Evro69kUt17HQQE26QxjEgpVhlxjoCBTZh26U/lzubVhSBhO+crOrVJnjf046XW6kZUlqWpju8ZD7XbxHSO27i7v7FymZCzdna6n5uO583GsEoBZoIGpTZ1GyG1Nw9/T2gqNUB4/DoKDzXJ47ZvTUrIqe5LKFpCmLRYOinP4y7A4cZCezW2Y7al+0SCTb6A8rruOC4jktDNJiGrUZU5FjJMDK43jeZHdjjuHajkLwx8Vt2E5BA3K/X37GcPDb5Nh/LnqYGdihwl7rhF1YrGsug7yAmHk+vGstxkgyfHoaZC12RbLW+guPMl49PTJIoCrq0SnnCoySbidn3KPmftunSN41QGso6Vj7KZgkWMi4RTdg7xRXntnm/38chFZ3zJFzU5EjsVqn+T5uY5b2JDs426haasITFkZ6Jea1f/YA7M=
